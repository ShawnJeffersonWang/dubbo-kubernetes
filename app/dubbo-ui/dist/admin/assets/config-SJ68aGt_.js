import{C as $}from"./ConfigPage-wjjvGN3B.js";import{d as H,u as M,r as R,n as F,O as q,f as C,c as t,t as o,h as O,e as f,o as d,F as L,x as D,v,y as z,z as I,H as A,I as S,J as U,_ as K}from"./index-PIJJkkQe.js";import{u as Q,d as X,e as Y,f as Z,h as ee,i as ae}from"./app-W3WTYQeG.js";import"./request-5Xt99UU9.js";const te={class:"__container_app_config"},oe={style:{float:"right"}},le={style:{float:"right"}},ne=H({__name:"config",setup(se){const k=M();let w=R({list:[{title:"applicationDomain.operatorLog",key:"log",form:{logFlag:!1},submit:e=>new Promise(a=>{a(G(e==null?void 0:e.logFlag))}),reset(e){e.logFlag=!1}},{title:"applicationDomain.flowWeight",key:"flow",ext:{title:"添加权重配置",fun(){}},form:{rules:[{weight:10,scope:{key:"version",value:{exact:"v1"}}}]},submit(e){return new Promise(a=>{a(V())})}},{title:"applicationDomain.gray",key:"gray",ext:{title:"添加灰度环境",fun(){}},form:{rules:[{name:"env-nam",scope:{key:"env",value:{exact:"gray"}}}]},submit(e){return new Promise(a=>{a(j())})}}],current:[0]});const N=async()=>{var a;const e=await Z((a=k.params)==null?void 0:a.pathId);console.log(e),(e==null?void 0:e.code)==200&&w.list.forEach(n=>{if(n.key==="log"){n.form.logFlag=e.data.operatorLog;return}})},G=async e=>{var n;const a=await Q((n=k.params)==null?void 0:n.pathId,e);console.log(a),(a==null?void 0:a.code)==200&&await N()},y=F([]),g=F([]),W=async()=>{var a;const e=await ee((a=k.params)==null?void 0:a.pathId);(e==null?void 0:e.code)==200&&w.list.forEach(n=>{n.key==="flow"&&(n.form.rules=JSON.parse(JSON.stringify(e.data.flowWeightSets)),n.form.rules.forEach(l=>{Object.keys(l.scope.value).length==0&&(y.value.push(""),g.value.push(""));for(const[i,u]of Object.entries(l.scope.value))y.value.push(i),g.value.push(u);l.scope.value={}}))})},V=async()=>{var n;let e=[];w.list.forEach(l=>{l.key==="flow"&&(e=JSON.parse(JSON.stringify(l.form.rules)),e.forEach((i,u)=>{y.value[u]&&g.value[u]&&(i.scope.value[y.value[u]]=g.value[u])}))}),(await X((n=k.params)==null?void 0:n.pathId,e)).code===200&&(y.value=[],g.value=[],await W())},m=F([]),_=F([]),E=async()=>{var a;const e=await ae((a=k.params)==null?void 0:a.pathId);(e==null?void 0:e.code)==200&&w.list.forEach(n=>{n.key==="gray"&&(n.form.rules=JSON.parse(JSON.stringify(e.data.graySets)),n.form.rules.forEach(l=>{Object.keys(l.scope.value).length==0&&(m.value.push(""),_.value.push(""));for(const[i,u]of Object.entries(l.scope.value))m.value.push(i),_.value.push(u);l.scope.value={}}))})},j=async()=>{var n;let e=[];w.list.forEach(l=>{l.key==="gray"&&(e=JSON.parse(JSON.stringify(l.form.rules)),e.forEach((i,u)=>{m.value[u]&&_.value[u]&&(i.scope.value[m.value[u]]=_.value[u])}))}),(await Y((n=k.params)==null?void 0:n.pathId,e)).code===200&&(m.value=[],_.value=[],await E())};return q(()=>{console.log(333),N(),W(),E()}),(e,a)=>{const n=f("a-switch"),l=f("a-form-item"),i=f("a-button"),u=f("a-space"),B=f("a-input-number"),h=f("a-input"),J=f("a-table"),x=f("a-card");return d(),C("div",te,[t($,{options:O(w)},{form_log:o(({current:b})=>[t(l,{label:e.$t("applicationDomain.operatorLog"),name:"logFlag"},{default:o(()=>[t(n,{checked:b.form.logFlag,"onUpdate:checked":r=>b.form.logFlag=r},null,8,["checked","onUpdate:checked"])]),_:2},1032,["label"])]),form_flow:o(({current:b})=>[t(u,{direction:"vertical",size:"middle",class:"flowWeight-box"},{default:o(()=>[(d(!0),C(L,null,D(b.form.rules,(r,s)=>(d(),v(x,null,{title:o(()=>[z(I(e.$t("applicationDomain.flowWeight"))+" "+I(s+1)+" ",1),A("div",oe,[t(u,null,{default:o(()=>[t(i,{type:"dashed",onClick:a[0]||(a[0]=()=>{})},{default:o(()=>[t(O(S),{style:{"font-size":"20px"},icon:"material-symbols-light:contract-edit"})]),_:1}),t(i,{danger:"",type:"dashed",onClick:a[1]||(a[1]=()=>{})},{default:o(()=>[t(O(S),{style:{"font-size":"20px"},icon:"fluent:delete-12-filled"})]),_:1})]),_:1})])]),default:o(()=>[t(l,{name:"rules["+s+"].weight",label:"权重"},{default:o(()=>[t(B,{min:"1",value:r.weight,"onUpdate:value":c=>r.weight=c},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),t(l,{label:"作用范围"},{default:o(()=>[t(J,{style:{width:"40vw"},pagination:!1,columns:[{key:"label",title:"label"},{key:"condition",title:"condition"},{key:"value",title:"value"}],"data-source":[r.scope]},{bodyCell:o(({column:c,record:P,index:T})=>[c.key==="label"?(d(),v(l,{key:0,name:"rules["+s+"].scope.key"},{default:o(()=>[t(h,{value:r.scope.key,"onUpdate:value":p=>r.scope.key=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0),c.key==="condition"?(d(),v(l,{key:1,name:"rules["+s+"].scope.condition"},{default:o(()=>[t(h,{value:y.value[s],"onUpdate:value":p=>y.value[s]=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0),c.key==="value"?(d(),v(l,{key:2,name:"rules["+s+"].scope.value"},{default:o(()=>[t(h,{value:g.value[s],"onUpdate:value":p=>g.value[s]=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024))),256))]),_:2},1024)]),form_gray:o(({current:b})=>[t(u,null,{default:o(()=>[(d(!0),C(L,null,D(b.form.rules,(r,s)=>(d(),v(x,null,{title:o(()=>[z(I(e.$t("applicationDomain.gray"))+" "+I(s+1)+" ",1),A("div",le,[t(u,null,{default:o(()=>[t(i,{type:"dashed",onClick:a[2]||(a[2]=()=>{})},{default:o(()=>[t(O(S),{style:{"font-size":"20px"},icon:"material-symbols-light:contract-edit"})]),_:1}),t(i,{danger:"",type:"dashed",onClick:a[3]||(a[3]=()=>{})},{default:o(()=>[t(O(S),{style:{"font-size":"20px"},icon:"fluent:delete-12-filled"})]),_:1})]),_:1})])]),default:o(()=>[t(l,{name:"rules["+s+"].name",label:"环境名称"},{default:o(()=>[t(h,{value:r.name,"onUpdate:value":c=>r.name=c},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),t(l,{label:"作用范围"},{default:o(()=>[t(J,{style:{width:"40vw"},pagination:!1,columns:[{key:"label",title:"label"},{key:"condition",title:"condition"},{key:"value",title:"value"}],"data-source":[r.scope]},{bodyCell:o(({column:c,record:P,index:T})=>[c.key==="label"?(d(),v(l,{key:0,name:"rules["+s+"].scope.key"},{default:o(()=>[t(h,{value:r.scope.key,"onUpdate:value":p=>r.scope.key=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0),c.key==="condition"?(d(),v(l,{key:1,name:"rules["+s+"].scope.condition"},{default:o(()=>[t(h,{value:m.value[s],"onUpdate:value":p=>m.value[s]=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0),c.key==="value"?(d(),v(l,{key:2,name:"rules["+s+"].scope.value"},{default:o(()=>[t(h,{value:_.value[s],"onUpdate:value":p=>_.value[s]=p},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):U("",!0)]),_:2},1032,["data-source"])]),_:2},1024)]),_:2},1024))),256))]),_:2},1024)]),_:1},8,["options"])])}}}),pe=K(ne,[["__scopeId","data-v-181d39e5"]]);export{pe as default};
