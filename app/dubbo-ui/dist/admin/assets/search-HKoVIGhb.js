import{d as N,k as C,b as R,r as T,f as l,c as h,t as d,h as f,P as V,K as q,e as g,o as c,F as y,y as p,z as v,H as b,I as A,v as G,x as P,J as D,m as E,_ as $}from"./index-0c4Jk4Xf.js";import{s as B}from"./service-IxCH0OfI.js";import{S as O,a as Q}from"./SearchUtil-d0dwRZMb.js";import{q as _}from"./promQuery-2KGsc03l.js";import"./request-fr6f-AQz.js";const M={class:"__container_services_index"},F=["onClick"],H=N({__name:"search",setup(J){C(a=>({"137be675":f(V)}));const S=R(),k=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%"},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],m=a=>a.map(e=>(e.versionGroupSelect={},e.versionGroupSelect.versionGroupArr=e.versionGroups.map(t=>t.versionGroup=(t.version?"version: "+t.version+", ":"")+(t.group?"group: "+t.group:"")||"æ— "),e.versionGroupSelect.versionGroupValue=e.versionGroupSelect.versionGroupArr[0],e));function I(a){return B(a).then(async e=>{var s;let t=(s=e==null?void 0:e.data)==null?void 0:s.list;try{for(let r of t){let n=await _(`sum (dubbo_provider_qps_total{interface='${r.serviceName}'}) by (interface)`),o=await _(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${r.serviceName}",method=~"$method"}>0)`),i=await _(`sum (increase(dubbo_provider_requests_total{interface="${r.serviceName}"}[1m]))`);r.avgQPS=n,r.avgRT=o,r.requestTotal=i}}catch(r){console.error(r)}return e})}const u=T(new O([{label:"serviceName",param:"keywords",placeholder:"typeAppName",style:{width:"200px"}}],I,k,void 0,void 0,m));u.onSearch(m);const x=(a,e)=>{var r,n;let t=((r=extractVersionAndGroup(e))==null?void 0:r.group)||"",s=((n=extractVersionAndGroup(e))==null?void 0:n.version)||"";S.push({name:"distribution",params:{pathId:a,group:t,version:s}})};return q(E.SEARCH_DOMAIN,u),(a,e)=>{const t=g("a-select-option"),s=g("a-select");return c(),l("div",M,[h(Q,{"search-domain":u},{bodyCell:d(({column:r,record:n,text:o})=>[r.dataIndex==="serviceName"?(c(),l(y,{key:0},[p(v(n.versionGroup)+" ",1),b("span",{class:"service-link",onClick:i=>x(o,o.versionGroupValue)},[b("b",null,[h(f(A),{style:{"margin-bottom":"-2px"},icon:"material-symbols:attach-file-rounded"}),p(" "+v(o),1)])],8,F)],64)):r.dataIndex==="versionGroupSelect"?(c(),G(s,{key:1,value:o.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:d(()=>[(c(!0),l(y,null,P(o.versionGroupArr,(i,w)=>(c(),G(t,{value:i,key:w},{default:d(()=>[p(v(i),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):D("",!0)]),_:1},8,["search-domain"])])}}}),U=$(H,[["__scopeId","data-v-b7f37077"]]);export{U as default};
